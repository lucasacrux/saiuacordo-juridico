<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SaiuAcordo • Escolher operação</title>
<style>
  :root{
    --bg:#0f1222; --card:#151935; --muted:#9aa3b2; --text:#e8ecf3;
    --brand:#8A05BE; --brand-700:#6b0495; --ok:#1DB954; --ok-700:#159c44;
    --warn:#e5a100; --bad:#e94b4b; --border:#2a2f53; --soft:#1b2042;
  }
  .theme-light{
    --bg:#F5F7FA; --card:#FFFFFF; --soft:#FAFBFF; --text:#1F2937; --muted:#6B7280; --border:#E5E7EB;
    --brand:#0B5ED7; --brand-700:#0848A8; --ok:#16A34A; --ok-700:#11803A; --bad:#DC2626; --warn:#B45309;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#0b0e1a 40%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{min-height:100dvh;display:grid;place-items:center;padding:16px}
  .shell{width:100%;max-width:1100px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .head{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border)}
  .brand{display:flex;align-items:center;gap:10px}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--brand)}
  .brand h1{font-size:18px;margin:0}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .btnTop{border:1px solid var(--border);background:transparent;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btnTop:hover{background:rgba(255,255,255,.06)}

  .body{padding:16px}
  .chips{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}
  .chip{background:transparent;border:1px solid var(--border);color:var(--text);border-radius:999px;padding:6px 10px;font-size:12px}

  .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}

  .op{display:flex;flex-direction:column;gap:10px;align-items:flex-start;justify-content:space-between;border:1px solid var(--border);border-radius:14px;padding:14px;min-height:140px;position:relative;background:linear-gradient(180deg,var(--card),var(--soft))}
  .op h2{margin:0;font-size:18px}
  .op p{margin:0;color:var(--muted);font-size:13px}
  .pill{font-size:11px;border:1px solid var(--border);border-radius:999px;padding:4px 8px;color:var(--muted)}
  .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-refi{background:var(--brand);color:#fff}
  .btn-refi:hover{background:var(--brand-700)}
  .btn-antec{background:var(--ok);color:#fff}
  .btn-antec:hover{background:var(--ok-700)}
  .btn-lock{background:#23284f;color:#8a93a7;cursor:not-allowed;border:1px dashed #3a406d}
  .badge{position:absolute;top:10px;right:10px;font-size:11px;padding:4px 8px;border-radius:999px}
  .badge-ok{background:rgba(29,185,84,.12);color:#8ef2b1;border:1px solid rgba(29,185,84,.25)}
  .badge-bad{background:rgba(233,75,75,.12);color:#ff9c9c;border:1px solid rgba(233,75,75,.25)}

  .note{margin-top:8px;font-size:12px;color:var(--muted)}
  .why{margin-top:6px;background:transparent;border:1px solid var(--border);padding:10px;border-radius:10px;font-size:12px;color:var(--text)}
  .why h3{margin:0 0 6px 0;font-size:12px;color:#ffb86b}

  .footer{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:12px;font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <div class="shell card">
      <div class="head">
        <div class="brand"><span class="dot"></span><h1>Escolher operação</h1></div>
        <div class="actions">
          <button class="btnTop" id="btnVoltarAcordos">← Voltar para Acordos</button>
          <button class="btnTop" id="btnVoltarCPF">← Nova busca por CPF</button>
        </div>
      </div>

      <div class="body">
        <div id="chips" class="chips"></div>

        <div class="grid" style="margin-top:12px">
          <div class="op" id="opRefi">
            <span class="pill">Fluxo mensal</span>
            <h2>Refinanciamento</h2>
            <p>Retome pagamentos ajustando taxa, prazo e vencimentos (inclui quebrados/atrasados).</p>
            <button class="btn btn-refi" id="btnRefi">Ir para Refinanciamento</button>
            <span class="badge badge-ok" id="bRefi">Disponível</span>
          </div>
          <div class="op" id="opAntec">
            <span class="pill">Desconto à vista</span>
            <h2>Antecipação</h2>
            <p>Antecipe parcelas/quite com desconto (somente acordos aceitos e normais).</p>
            <button class="btn btn-antec" id="btnAntec">Ir para Antecipação</button>
            <span class="badge badge-ok" id="bAntec">Disponível</span>
          </div>
          <div class="op" id="opOrig">
            <span class="pill">Base contratual</span>
            <h2>Parcelas Originais</h2>
            <p>Reconstrua o parcelamento original e simule encargos, prescrição e atualização.</p>
            <button class="btn btn-refi" id="btnOrig">Ir para Parcelas Originais</button>
            <span class="badge badge-ok" id="bOrig">Disponível</span>
          </div>
        </div>

        <div class="note" id="eligNote"></div>
        <div class="why" id="eligWhy" style="display:none"></div>

        <div class="footer">
          <span>Quer começar de novo? <a href="cpf.html" style="color:inherit">Nova busca por CPF</a></span>
          <span id="opInfo"></span>
        </div>
      </div>
    </div>
  </div>

<!-- === ADIÇÃO: bridge deve vir antes do script local === -->
<script src="/_sa-bridge.js"></script>

<script>
(function(){
  /* ===== Tema (herdado) ===== */
  try{
    var theme = sessionStorage.getItem('ui.theme');
    if (theme === 'light') { document.body.classList.add('theme-light'); }
    else { document.body.classList.remove('theme-light'); }
  }catch(_){}

  /* ===== Contexto ===== */
  var origem = '';
  try{ origem = sessionStorage.getItem('wizard.origem') || ''; }catch(_){}
  let acordo = {};
  try { acordo = JSON.parse(sessionStorage.getItem('wizard.acordo') || '{}'); } catch(e) { acordo = {}; }

  // fallback para dados do contrato (nome/CPF etc.)
  let contratoCtx = {};
  try { contratoCtx = JSON.parse(sessionStorage.getItem('wizard.contrato') || '{}'); } catch(e) { contratoCtx = {}; }

  if(!acordo || (!acordo.acordoId && !acordo.id) && origem !== 'contrato-sem-acordo'){
    location.replace('acordos.html'); return;
  }

  /* ===== Helpers gerais ===== */
  const fmtBRL = v => (Number(v||0)).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  const onlyDigits = s => (s||'').replace(/\D+/g,'');
  function formatCPF(c){ const d = onlyDigits(c).padStart(11,'0'); return d.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4'); }
  function dateOnly(d){
    if (!d) return null;
    if (d instanceof Date && !isNaN(d)) return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    if (typeof d === 'string'){
      const s = d.trim();
      if (/^\d{4}-\d{2}-\d{2}/.test(s)){ const [y,m,day] = s.split('T')[0].split('-').map(Number); return new Date(y, m-1, day); }
      if (/^\d{2}\/\d{2}\/\d{4}$/.test(s)){ const [day,m,y] = s.split('/').map(Number); return new Date(y, m-1, day); }
      const n = new Date(s); if (!isNaN(n)) return new Date(n.getFullYear(), n.getMonth(), n.getDate()); return null;
    }
    const n = new Date(d); return isNaN(n) ? null : new Date(n.getFullYear(), n.getMonth(), n.getDate());
  }
  const hoje = dateOnly(new Date());
  const mesIni = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
  const mesFim = new Date(hoje.getFullYear(), hoje.getMonth()+1, 0);

  /* ===== Parcial: encontrar array de parcelas se não veio colado ===== */
  function hydrateParcelas(ac){
    if (Array.isArray(ac.parcelas) && ac.parcelas.length) return ac;
    const alvoId = String(ac.acordoId ?? ac.id ?? '');
    for (let i=0; i<sessionStorage.length; i++){
      const k = sessionStorage.key(i); if (k === 'wizard.acordo') continue;
      try{
        const raw = sessionStorage.getItem(k); const obj = JSON.parse(raw);
        const candidatos = []
          .concat(Array.isArray(obj)? obj : [])
          .concat(Array.isArray(obj?.result)? obj.result : [])
          .concat(Array.isArray(obj?.data?.result)? obj.data.result : [])
          .concat(Array.isArray(obj?.data)? obj.data : [])
          .concat(Array.isArray(obj?.acordos)? obj.acordos : [])
          .concat(Array.isArray(obj?.acordo_ativo)? obj.acordo_ativo : []);
        for (const c of candidatos){
          if (!c) continue;
          if (String(c?.acordoId ?? c?.id ?? '') === alvoId && Array.isArray(c?.parcelas)){
            ac.parcelas = c.parcelas; return ac;
          }
        }
      }catch(_){}
    }
    return ac;
  }
  if (origem !== 'contrato-sem-acordo') acordo = hydrateParcelas(acordo);

  /* ===== Regras de status — semântica do negócio ===== */
  function isAtivoStrict(ac){ return String(ac?.active ?? ac?.Active ?? '').trim().toUpperCase() === 'ATIVO'; }

  function getIdStatus(ac){
    // 1=simulação, 3=aceito (se não vier, usaremos isAceito)
    const raw = ac?.idstatus ?? ac?.idStatus ?? ac?.statusId ?? null;
    return Number(raw || 0);
  }

  // <<< NOVO: “ATIVO” implica ACEITO (status 3), mesmo sem idstatus >>>
  function isAceito(ac){
    const idst = getIdStatus(ac);
    if (idst === 3) return true;
    if (isAtivoStrict(ac)) return true;
    return false;
  }

  function getSituacaoCode(ac){
    // 0 normal, 1 quebrado, 2 atrasado, 3 liquidado
    if (ac?.situacao != null && !isNaN(Number(ac.situacao))) return Number(ac.situacao);
    const s = (String(ac?.situacaoAcordo ?? ac?.status ?? '').toUpperCase());
    if (/LIQUID/.test(s)) return 3;
    if (/QUEBR/.test(s))  return 1;
    if (/ATRAS/.test(s))  return 2;
    return 0; // default NORMAL
  }

  function isParcelaPaga(p){
    const st  = String(p?.situacao || p?.situacaoPagamento || '').toUpperCase();
    const pagoPorStatus = /(LIQUID|QUITAD|PAG[OA]|RECEBID)/.test(st);
    const pagoPorValor  = Number(p?.valor_pago||p?.valorPago||0) >= Math.max(0, Number(p?.valor||0));
    const temDataPg     = !!(p?.data_pagamento || p?.dataPagamento);
    return pagoPorStatus || pagoPorValor || temDataPg;
  }

  function hasAbertaEmAtraso(parcelas){
    return (parcelas||[]).some(p=>{
      const dv = dateOnly(p?.dataVencimento || p?.vencimento);
      return dv && dv < hoje && !isParcelaPaga(p);
    });
  }

  function parcelaDoMesOk(parcelas){
    // “parcela do mês a vencer ou paga”
    const doMes = (parcelas||[]).filter(p=>{
      const dv = dateOnly(p?.dataVencimento || p?.vencimento);
      return dv && dv >= mesIni && dv <= mesFim;
    });
    if (!doMes.length){
      // se não há parcela neste mês, consideramos OK desde que não exista aberta em atraso
      return !hasAbertaEmAtraso(parcelas);
    }
    // há parcela no mês — ela precisa estar paga OU ainda não vencida
    return doMes.every(p=>{
      const dv = dateOnly(p?.dataVencimento || p?.vencimento);
      return isParcelaPaga(p) || (dv && dv >= hoje);
    });
  }

  function saldoAberto(parcelas){
    return (parcelas||[]).reduce((s,p)=> s + (isParcelaPaga(p) ? 0 : Number(p?.valor||0)), 0);
  }

  /* ===== Chips (com fallback do contrato) ===== */
  const nomeCliente = acordo?.nomeCliente || contratoCtx?.nomeCliente || '';
  const cpfCliente  = acordo?.cpfCliente  || contratoCtx?.cpfCliente  || '';
  const carteira    = acordo?.nomeCarteira|| contratoCtx?.nomeCarteira|| '';
  const contratoNum = acordo?.numContrato || acordo?.contrato_id || acordo?.numeroContrato || contratoCtx?.numContrato || '';

  const chips = [];
  if (nomeCliente) chips.push(`<span class="chip">${nomeCliente}</span>`);
  if (cpfCliente)  chips.push(`<span class="chip">CPF ${formatCPF(cpfCliente)}</span>`);
  if (carteira)    chips.push(`<span class="chip">Carteira ${carteira}</span>`);
  if (contratoNum) chips.push(`<span class="chip">Contrato ${contratoNum}</span>`);
  if (origem !== 'contrato-sem-acordo'){
    const parc = Array.isArray(acordo.parcelas)? acordo.parcelas : [];
    chips.push(`<span class="chip">Acordo #${acordo?.acordoId ?? acordo?.id ?? '—'}</span>`);
    chips.push(`<span class="chip">${parc.length} parcelas</span>`);
    chips.push(`<span class="chip">Saldo aberto ${fmtBRL(saldoAberto(parc))}</span>`);
  }
  document.getElementById('chips').innerHTML = chips.join('');

  /* ===== Elegibilidade ===== */
  const parc = Array.isArray(acordo.parcelas)? acordo.parcelas : [];
  const ativo  = origem !== 'contrato-sem-acordo' ? isAtivoStrict(acordo) : false;
  const aceito = origem !== 'contrato-sem-acordo' ? isAceito(acordo) : false;   // <<< usamos isto
  const sit    = getSituacaoCode(acordo); // 0 normal, 1 quebrado, 2 atrasado, 3 liquidado

  // --- REFINANCIAMENTO ---
  const podeRefi = (origem !== 'contrato-sem-acordo') && ativo && (sit !== 3) && (saldoAberto(parc) > 0);

  const btnRefi = document.getElementById('btnRefi');
  const bRefi   = document.getElementById('bRefi');
  const opRefi  = document.getElementById('opRefi');

  if (!podeRefi){
    btnRefi.disabled = true;
    btnRefi.className = 'btn btn-lock';
    bRefi.className   = 'badge badge-bad';
    bRefi.textContent = 'Indisponível';
    opRefi.style.outline = '2px dashed #4a4f7a';
  } else {
    btnRefi.disabled = false;
    btnRefi.className = 'btn btn-refi';
    bRefi.className   = 'badge badge-ok';
    bRefi.textContent = 'Disponível';
    opRefi.style.outline = 'none';
  }

  // --- ANTECIPAÇÃO ---
  const semAtrasoAberto = !hasAbertaEmAtraso(parc);
  const parcelaMesOK    = parcelaDoMesOk(parc);
  const podeAntec = (origem !== 'contrato-sem-acordo')
                 && ativo
                 && aceito            // <<< em vez de comparar idstatus
                 && sit === 0         // NORMAL
                 && semAtrasoAberto
                 && parcelaMesOK;

  const btnAntec = document.getElementById('btnAntec');
  const bAntec   = document.getElementById('bAntec');
  const eligNote = document.getElementById('eligNote');
  const eligWhy  = document.getElementById('eligWhy');
  const opAntec  = document.getElementById('opAntec');

  if (!podeAntec){
    btnAntec.disabled = true;
    btnAntec.className = 'btn btn-lock';
    bAntec.className   = 'badge badge-bad';
    bAntec.textContent = 'Indisponível';

    const motivos = [];
    if (origem === 'contrato-sem-acordo') motivos.push('• Não há acordo ativo para este contrato.');
    if (!ativo)   motivos.push('• Acordo não está ATIVO.');
    if (!aceito)  motivos.push('• Acordo ainda não ACEITO (status ≠ 3 / não ATIVO).');
    if (sit !== 0) motivos.push('• Situação do acordo não é NORMAL (regular).');
    if (!semAtrasoAberto) motivos.push('• Existe parcela em atraso aberta.');
    if (!parcelaMesOK) motivos.push('• Parcela do mês não está paga nem a vencer.');

    eligNote.textContent = 'Antecipação indisponível para este acordo.';
    eligWhy.style.display = 'block';
    eligWhy.innerHTML = `<h3>Motivos</h3>${motivos.join('<br>')}`;
    opAntec.style.outline = '2px dashed #4a4f7a';
  } else {
    btnAntec.disabled = false;
    btnAntec.className = 'btn btn-antec';
    bAntec.className   = 'badge badge-ok';
    bAntec.textContent = 'Disponível';
    eligNote.textContent = 'Antecipação habilitada: você pode antecipar/compactar parcelas com desconto.';
    eligWhy.style.display = 'none';
    opAntec.style.outline = 'none';
  }

  // --- PARCELAS ORIGINAIS ---
  const btnOrig = document.getElementById('btnOrig');
  const bOrig   = document.getElementById('bOrig');
  btnOrig.disabled = false;
  btnOrig.className = 'btn btn-refi';
  bOrig.className   = 'badge badge-ok';
  bOrig.textContent = 'Disponível';

  // Rodapé
  document.getElementById('opInfo').textContent =
    (podeAntec ? 'Antecipação disponível' : 'Antecipação indisponível')
    + ' • ' + (podeRefi ? 'Refinanciamento disponível' : 'Refinanciamento indisponível');

  /* ===== Navegação original ===== */
  document.getElementById('btnVoltarCPF').addEventListener('click', ()=>{
    try{ sessionStorage.removeItem('wizard.operacao'); }catch(e){}
    location.href = 'cpf.html';
  });
  document.getElementById('btnVoltarAcordos').addEventListener('click', ()=>{
    try{ sessionStorage.removeItem('wizard.operacao'); }catch(e){}
    location.href = 'acordos.html';
  });
  document.getElementById('btnRefi').addEventListener('click', ()=>{
    if (btnRefi.disabled) return;
    try{ sessionStorage.setItem('wizard.operacao','refinanciamento'); }catch(e){}
    location.href = 'calculadora-refinanciamento.html';
  });
  document.getElementById('btnAntec').addEventListener('click', ()=>{
    if (btnAntec.disabled) return;
    try{ sessionStorage.setItem('wizard.operacao','antecipacao'); }catch(e){}
    location.href = 'calculadora-antecipacao.html';
  });
  document.getElementById('btnOrig').addEventListener('click', ()=>{
    try{ sessionStorage.setItem('wizard.operacao','parcelas-originais'); }catch(e){}
    location.href = 'calculadora-parcelas-originais.html';
  });
})();
</script>

<!-- Fallback idempotente (mantido) -->
<script>
(function(){
  function navRefi(){ var b=document.getElementById('btnRefi'); if (b && b.disabled) return; try{ sessionStorage.setItem('wizard.operacao','refinanciamento'); }catch(e){} location.href='calculadora-refinanciamento.html'; }
  function navAntec(){ var b=document.getElementById('btnAntec'); if (b && b.disabled) return; try{ sessionStorage.setItem('wizard.operacao','antecipacao'); }catch(e){} location.href='calculadora-antecipacao.html'; }
  function navOrig(){ try{ sessionStorage.setItem('wizard.operacao','parcelas-originais'); }catch(e){} location.href='calculadora-parcelas-originais.html'; }
  function backCPF(){ try{ sessionStorage.removeItem('wizard.operacao'); }catch(e){} location.href='cpf.html'; }
  function backAcordos(){ try{ sessionStorage.removeItem('wizard.operacao'); }catch(e){} location.href='acordos.html'; }
  function wire(){
    var r=document.getElementById('btnRefi'); if(r && !r.__wired2){ r.__wired2=true; r.addEventListener('click', navRefi); }
    var a=document.getElementById('btnAntec'); if(a && !a.__wired2){ a.__wired2=true; a.addEventListener('click', navAntec); }
    var o=document.getElementById('btnOrig'); if(o && !o.__wired2){ o.__wired2=true; o.addEventListener('click', navOrig); }
    var c1=document.getElementById('btnVoltarCPF'); if(c1 && !c1.__wired2){ c1.__wired2=true; c1.addEventListener('click', backCPF); }
    var c2=document.getElementById('btnVoltarAcordos'); if(c2 && !c2.__wired2){ c2.__wired2=true; c2.addEventListener('click', backAcordos); }
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', wire); else wire();
})();
</script>

<!-- === Bridge (captura, preservado) === -->
<script>
(function(){
  if (window.__SA?.initStaticPage) window.__SA.initStaticPage('/escolha-operacao/index.html');

  const qs   = new URLSearchParams(location.search);
  const here = location.pathname + location.search;
  const theme = (localStorage.getItem('ui.theme') || sessionStorage.getItem('ui.theme') || 'dark');

  function go(url){
    if (!url) return;
    try { sessionStorage.setItem('spa.returnTo', url); localStorage.setItem('spa.returnTo', url); } catch(_){}
    location.assign(url);
  }

  function voltarAcordos(e){
    e.preventDefault(); e.stopImmediatePropagation();
    if (window.__SA?.back) { window.__SA.back(); return; }
    const rt = qs.get('returnTo');
    if (rt) { go(rt); return; }
    const cpf = qs.get('cpf') || (sessionStorage.getItem('wizard.cpf')||'');
    let contrato = qs.get('contrato');
    if (!contrato){
      try{ const c = JSON.parse(sessionStorage.getItem('wizard.contrato')||'{}'); contrato = c.numContrato || ''; }catch(_){}
    }
    const u = new URL('/acordos/home/index.html', location.origin);
    u.searchParams.set('theme', theme);
    if (cpf) u.searchParams.set('cpf', cpf);
    if (contrato) u.searchParams.set('contrato', contrato);
    u.searchParams.set('from','escolha');
    const home = '/home-consulta' + (cpf?`?cpf=${cpf}${contrato?`&contrato=${encodeURIComponent(contrato)}`:''}`:'');
    u.searchParams.set('returnTo', home);
    go(u.pathname + u.search);
  }

  function novaConsulta(e){
    e.preventDefault(); e.stopImmediatePropagation();
    try{
      sessionStorage.removeItem('wizard.acordo');
      sessionStorage.removeItem('wizard.contrato');
      sessionStorage.removeItem('wizard.operacao');
      sessionStorage.removeItem('wizard.cpf');
      sessionStorage.removeItem('contractFilter');
      sessionStorage.removeItem('last.cpf.response');
      sessionStorage.setItem('spa.returnTo','/home-consulta');
    }catch(_){}
    if (window.__SA?.goHome) { window.__SA.goHome({ reset:true }); return; }
    go('/home-consulta');
  }

  function openCalc(kind, e){
    e.preventDefault(); e.stopImmediatePropagation();
    try{ sessionStorage.setItem('wizard.operacao', kind); }catch(_){}
    if (window.__SA?.openCalculadora){
      window.__SA.openCalculadora(kind, { returnTo: here });
      return;
    }
    const paths = {
      'refinanciamento': (localStorage.getItem('paths.refin') || '/calculadoras/refinanciamento/index.html'),
      'antecipacao':     (localStorage.getItem('paths.antecip') || '/calculadoras/antecipacao/index.html'),
      'parcelas-originais': (localStorage.getItem('paths.originais') || '/calculadoras/parcelas-originais/index.html'),
    };
    const path = paths[kind];
    const u = new URL(path, location.origin);
    u.searchParams.set('theme', theme);
    u.searchParams.set('returnTo', here);
    go(u.pathname + u.search);
  }

  const btnVoltarAcordos = document.getElementById('btnVoltarAcordos');
  const btnVoltarCPF     = document.getElementById('btnVoltarCPF');
  const btnRefi          = document.getElementById('btnRefi');
  const btnAntec         = document.getElementById('btnAntec');
  const btnOrig          = document.getElementById('btnOrig');

  if (btnVoltarAcordos) btnVoltarAcordos.addEventListener('click', voltarAcordos, true);
  if (btnVoltarCPF)     btnVoltarCPF.addEventListener('click', novaConsulta, true);

  if (btnRefi)  btnRefi.addEventListener('click', (e)=>{ if (!btnRefi.disabled)  openCalc('refinanciamento', e); }, true);
  if (btnAntec) btnAntec.addEventListener('click', (e)=>{ if (!btnAntec.disabled) openCalc('antecipacao', e); }, true);
  if (btnOrig)  btnOrig.addEventListener('click', (e)=> openCalc('parcelas-originais', e), true);
})();
</script>

</body>
</html>
